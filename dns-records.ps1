# Prompt for the domain name
$domain = Read-Host "Enter the domain name"

# Specify the DNS server you want to use (you can change this to a different DNS server)
$dnsServer = "8.8.8.8"

# Perform a DNS lookup for PTR records for the given IP address (assuming the IP of the domain)
$ipAddresses = (Resolve-DnsName -Name $domain -Type A -Server $dnsServer -ErrorAction SilentlyContinue).IPAddress
$ptrRecords = @()

# Check if A records were found for the domain
if ($ipAddresses) {
    foreach ($ip in $ipAddresses) {
        $ptrRecord = (Resolve-DnsName -Name $ip -Type PTR -Server $dnsServer -ErrorAction SilentlyContinue).QueryType
        if ($ptrRecord -eq "PTR") {
            $ptrRecords += $ip
        }
    }

    if ($ptrRecords.Count -gt 0) {
        # If PTR records were found, print them
        Write-Host "`nPTR records found for IP addresses:`n"
        $ptrRecords | ForEach-Object { Write-Host $_ -ForegroundColor Green }
    } else {
        # If no PTR records were found, print a message
        Write-Host "`nNo PTR records found for IP addresses`n" -ForegroundColor Red
    }
} else {
    # If no A records were found for the domain, indicate the possibility of no PTR records
    Write-Host "`nPossibly no A records found for the domain`n" -ForegroundColor Yellow
}

# Perform a DNS lookup for A records for the 'www' subdomain
$aRecords = Resolve-DnsName -Name "www.$domain" -Type A -Server $dnsServer -ErrorAction SilentlyContinue

# Check if A records were found for 'www'
if ($aRecords) {
    $isIpAddresses = $aRecords | ForEach-Object { $_.IPAddress -as [ipaddress] }

    # Check if there is at least one IP address in the A records
    if ($isIpAddresses -contains $null) {
        # If at least one A record is not an IP address, indicate the possibility of a WAF
        Write-Host "`nA record for 'www' contains non-IP address values (Possibly a WAF service detected for the domain)`n" -ForegroundColor Green
    } else {
        # If all A record values are IP addresses, indicate no WAF
        Write-Host "`nA record for 'www' points to IP addresses (No WAF detected for the domain)`n" -ForegroundColor Red
    }
} else {
    # If no A records were found for 'www', indicate the possibility of no WAF
    Write-Host "`nPossibly no WAF detected for the domain`n"
}

# Perform a DNS lookup for MX records for the domain
$mxRecords = Resolve-DnsName -Name $domain -Type MX -Server $dnsServer -ErrorAction SilentlyContinue

# Check if MX records were found
if ($mxRecords) {
    # If MX records were found, check for Default DKIM and DMARC records
    $defaultDkimRecords = Resolve-DnsName -Name "default._domainkey.$domain" -Type TXT -Server $dnsServer -ErrorAction SilentlyContinue
    $dmarcRecords = Resolve-DnsName -Name "_dmarc.$domain" -Type TXT -Server $dnsServer -ErrorAction SilentlyContinue

    # Check if Default DKIM and DMARC records were found and print their values
    if ($defaultDkimRecords) {
        $defaultDkimValue = $defaultDkimRecords.Strings
        Write-Host "`nDefault DKIM record found: $defaultDkimValue`n" -ForegroundColor Green
    }

    else{

        Write-Host "`nNo DKIM record was found.`n" -ForegroundColor Yellow

    }
    if ($dmarcRecords) {
        $dmarcValue = $dmarcRecords.Strings
        Write-Host "`nDMARC record found: $dmarcValue`n" -ForegroundColor Green
    }

    else{
       Write-Host "`n No DMARC record found.`n" -ForegroundColor Yellow
    }

    # Use nslookup to fetch SPF records and suppress stderr
    $spfRecords = & nslookup -q=TXT -type=TXT $domain $dnsServer 2>$null
    if ($spfRecords -match "v=spf1") {
        # If SPF record is found, print it
        Write-Host "`nSPF record found: $spfRecords`n" -ForegroundColor Green
    } else {
        # If no SPF record is found, print a message
        Write-Host "`nNo SPF record found`n" -ForegroundColor Red
    }
} else {
    # If no MX records were found, indicate the absence of email-related DNS records
    Write-Host "No MX records found (Possibly no email services configured)"
}
